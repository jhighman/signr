(()=>{var Se=Object.defineProperty,xe=Object.defineProperties;var Be=Object.getOwnPropertyDescriptors;var le=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var ce=(t,o,e)=>o in t?Se(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e,H=(t,o)=>{for(var e in o||(o={}))_e.call(o,e)&&ce(t,e,o[e]);if(le)for(var e of le(o))Ce.call(o,e)&&ce(t,e,o[e]);return t},de=(t,o)=>xe(t,Be(o));var ue=(t,o,e)=>new Promise((r,a)=>{var d=s=>{try{n(e.next(s))}catch(l){a(l)}},i=s=>{try{n(e.throw(s))}catch(l){a(l)}},n=s=>s.done?r(s.value):Promise.resolve(s.value).then(d,i);n((e=e.apply(t,o)).next())});function A(t,o,e){let r=t.querySelector(o);r&&(r.required=e)}function z(t,o,e){let r=e-o,a=t.getFullYear(),d=t.getMonth(),i=t.getDate(),n=a-o+d/12+i/365.25;console.log(`Date: ${t.toISOString().substring(0,10)}, Years from start: ${n.toFixed(2)}`);let s=Math.max(0,Math.min(n,r));s!==n&&console.log(`Clamped years from ${n.toFixed(2)} to ${s.toFixed(2)}`);let l=s/r*100;return Math.max(0,Math.min(l,100))}function W(t){if(!t||t==="Present")return t||"";let[o,e]=t.split("-");return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(e)-1]} ${o}`}function N(t,o){return`${t.toISOString().substring(0,10)} to ${o.toISOString().substring(0,10)}`}var D=7,X=new Date().getFullYear(),me=X-D,te;function ye(t,o){D=t,X=new Date().getFullYear(),me=X-D,te=o;let e=document.getElementById("timeline-start-year"),r=document.getElementById("timeline-end-year");e&&(e.textContent=me),r&&(r.textContent=X)}function Q(){let o=document.getElementById("entries-list").querySelectorAll(".entry-summary");if(console.log(`Found ${o.length} entries to calculate years for`),o.length===0)return console.log("No entries found, returning 0 years"),0;D===0&&console.log("Years required is 0, calculating actual years for display only");let e=new Date,r=e.getFullYear(),a=e.getMonth(),d=r-D,i=new Date(d,0,1),n=new Date(e);console.log(`Required period: ${i.toISOString().substring(0,10)} to ${n.toISOString().substring(0,10)}`);let s=[];o.forEach(y=>{let f=y.getAttribute("data-index");console.log(`Processing entry ${f}: ${y.textContent.trim().substring(0,50)}...`);let g=y.textContent.trim(),I=null,b=null,S=!1,x=g.match(/([A-Z][a-z]{2} \d{4}) - (Present|[A-Z][a-z]{2} \d{4})/);if(x){let _=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],C=x[1].split(" "),F=_.indexOf(C[0])+1;if(I=`${parseInt(C[1])}-${F.toString().padStart(2,"0")}`,x[2]==="Present")S=!0,b=null;else{let T=x[2].split(" "),J=_.indexOf(T[0])+1;b=`${parseInt(T[1])}-${J.toString().padStart(2,"0")}`}console.log(`Extracted dates from entry text: ${I} to ${S?"Present":b}`)}let B=document.getElementById(`start_date_${f}`),c=document.getElementById(`end_date_${f}`),p=document.getElementById(`is_current_${f}`),E=document.getElementById(`entry_type_${f}`),v=B&&B.value?B.value:I,h=c&&c.value?c.value:b,$=p&&p.checked||S;if(console.log(`Entry ${f} inputs:`,{type:E==null?void 0:E.value,startDate:v,endDate:h,isCurrent:$}),v){let _=v.split("-"),C=parseInt(_[0]),F=parseInt(_[1])-1,V=new Date(C,F,1),T;if($)T=new Date(e),console.log(`Entry ${f} is current, using today's date: ${T.toISOString().substring(0,10)}`);else if(h){let J=h.split("-"),M=parseInt(J[0]),L=parseInt(J[1])-1,j=new Date(M,L+1,0).getDate();T=new Date(M,L,j)}T&&V<=T?(s.push({startDate:V,endDate:T,startStr:v,endStr:$?"Present":h,index:f}),console.log(`Added date range for entry ${f}: ${v} to ${$?"Present":h}`)):console.log(`Invalid date range for entry ${f}: ${v} to ${$?"Present":h||"undefined"}`)}else console.log(`Entry ${f} has no start date`)}),s.sort((y,f)=>y.startDate-f.startDate),console.log("Date ranges before merging:",s.map(y=>`Entry ${y.index}: ${y.startStr} to ${y.endStr} (${N(y.startDate,y.endDate)})`));let l=[];if(s.length>0){let y=H({},s[0]);for(let f=1;f<s.length;f++){let g=s[f];g.startDate<=new Date(y.endDate.getTime()+864e5)?(g.endDate>y.endDate&&(y.endDate=g.endDate,y.endStr=g.endStr),console.log(`Merged entry ${g.index} into entry ${y.index}`)):(l.push(y),y=H({},g))}l.push(y)}console.log("Merged date ranges:",l.map(y=>`${y.startStr} to ${y.endStr} (${N(y.startDate,y.endDate)})`));let u=0;l.forEach(y=>{let f=new Date(Math.max(y.startDate.getTime(),i.getTime())),g=new Date(Math.min(y.endDate.getTime(),n.getTime()));if(f>g){console.log(`Range ${y.startStr} to ${y.endStr} is outside the required period`);return}let I=365.25*24*60*60*1e3,b=(g.getTime()-f.getTime())/I;console.log(`Range ${y.startStr} to ${y.endStr}: clipped to ${N(f,g)} = ${b.toFixed(2)} years`),u+=b});let m=Math.round(u*10)/10;return m>=D?(console.log(`Total years accounted: ${D.toFixed(1)} (capped from ${m.toFixed(1)})`),D):(console.log(`Total years accounted: ${m.toFixed(1)} (raw: ${u.toFixed(2)})`),m)}function ee(){let t=document.getElementById("timeline-segments");if(!t)return;t.innerHTML="";let o=new Date,e=o.getFullYear(),r=o.getMonth(),a=e-D,d=new Date(a,0,1),i=new Date(o);console.log(`Required period for visualization: ${d.toISOString().substring(0,10)} to ${i.toISOString().substring(0,10)}`);let n=document.createElement("div");n.className="required-period-background",n.style.width="100%",n.style.height="100%",n.style.position="absolute",n.style.backgroundColor="rgba(230, 240, 255, 0.5)",n.style.zIndex="1",n.style.borderRadius="4px",n.style.border="1px dashed #6c757d",t.appendChild(n);for(let c=a;c<=e;c++){let p=document.createElement("div");p.className="year-marker";let E=(c-a)/D*100;p.style.left=`${E}%`,p.style.position="absolute",p.style.height="10px",p.style.borderLeft="1px solid #6c757d",p.style.top="-15px",p.style.zIndex="2";let v=document.createElement("div");v.className="year-label",v.textContent=c,v.style.position="absolute",v.style.top="-30px",v.style.fontSize="10px",v.style.transform="translateX(-50%)",p.appendChild(v),t.appendChild(p)}let s=[],u=document.getElementById("entries-list").querySelectorAll(".entry-summary");u.forEach(c=>{var _,C,F;let p=c.getAttribute("data-index"),E=(_=document.getElementById(`entry_type_${p}`))==null?void 0:_.value,v=document.getElementById(`start_date_${p}`),h=document.getElementById(`end_date_${p}`),$=document.getElementById(`is_current_${p}`);if(v&&v.value){let V=v.value.split("-"),T=parseInt(V[0]),J=parseInt(V[1])-1,M=new Date(T,J,1),L;if($&&$.checked)L=new Date(o);else if(h&&h.value){let j=h.value.split("-"),G=parseInt(j[0]),U=parseInt(j[1])-1,be=new Date(G,U+1,0).getDate();L=new Date(G,U,be)}if(L&&M<=L)if(M<=i&&L>=d){let G=M,U=L;M<d&&(G=new Date(d),console.log(`Clipped start date from ${M.toISOString().substring(0,10)} to ${G.toISOString().substring(0,10)}`)),L>i&&(U=new Date(i),console.log(`Clipped end date from ${L.toISOString().substring(0,10)} to ${U.toISOString().substring(0,10)}`)),s.push({type:E,startDate:G,endDate:U,company:((C=document.getElementById(`company_${p}`))==null?void 0:C.value)||"",position:((F=document.getElementById(`position_${p}`))==null?void 0:F.value)||"",originalStartDate:M,originalEndDate:L,originalStartDateStr:v.value,originalEndDateStr:$.checked?"Present":h.value,index:p})}else console.log(`Entry ${p} (${v.value} to ${$.checked?"Present":h.value}) does not overlap with required period`)}}),s.sort((c,p)=>c.startDate-p.startDate),console.log("Valid entries for visualization:",s.map(c=>`${c.type} (${N(c.startDate,c.endDate)})`)),s.forEach((c,p)=>{let E=z(c.startDate,a,e),v=z(c.endDate,a,e),h=Math.max(v-E,2);console.log(`Entry ${p}: Position ${E.toFixed(1)}% to ${v.toFixed(1)}%, width ${h.toFixed(1)}%`);let $=document.createElement("div");$.className=`timeline-segment ${c.type.toLowerCase()}`,$.style.left=`${E}%`,$.style.width=`${h}%`,$.style.zIndex="3";let _=document.createElement("div");_.className="timeline-segment-tooltip";let C="";c.type==="Job"||c.type==="Education"?C=`${c.position} at ${c.company}
${W(c.originalStartDateStr)} - ${W(c.originalEndDateStr)}`:C=`${c.type}
${W(c.originalStartDateStr)} - ${W(c.originalEndDateStr)}`,_.textContent=C,$.appendChild(_),t.appendChild($)});let m=[];if(s.length>0){let c=H({},s[0]);for(let p=1;p<s.length;p++){let E=s[p];E.startDate<=new Date(c.endDate.getTime()+864e5)?E.endDate>c.endDate&&(c.endDate=E.endDate):(m.push(c),c=H({},E))}m.push(c)}if(console.log("Merged entries for gap detection:",m.map(c=>`${c.type} (${N(c.startDate,c.endDate)})`)),m.length>1)for(let c=0;c<m.length-1;c++){let p=m[c].endDate,E=m[c+1].startDate;if((E-p)/(24*60*60*1e3)>1){let h=z(p,a,e),$=z(E,a,e),_=$-h;console.log(`Gap: ${N(p,E)}, Position ${h.toFixed(1)}% to ${$.toFixed(1)}%, width ${_.toFixed(1)}%`);let C=document.createElement("div");C.className="timeline-segment gap",C.style.left=`${h}%`,C.style.width=`${_}%`,C.style.zIndex="2";let F=document.createElement("div");F.className="timeline-segment-tooltip",F.textContent="Gap",C.appendChild(F),t.appendChild(C)}}if(m.length>0&&m[0].startDate>d){let p=z(m[0].startDate,a,e),E=p-0;if(E>1){console.log(`Initial gap: ${N(d,m[0].startDate)}, Position ${0 .toFixed(1)}% to ${p.toFixed(1)}%, width ${E.toFixed(1)}%`);let v=document.createElement("div");v.className="timeline-segment gap",v.style.left="0%",v.style.width=`${E}%`,v.style.zIndex="2";let h=document.createElement("div");h.className="timeline-segment-tooltip",h.textContent="Gap",v.appendChild(h),t.appendChild(v)}}if(m.length>0){let c=m[m.length-1];if(c.endDate<i){let p=z(c.endDate,a,e),E=100,v=E-p;if(v>1){console.log(`Final gap: ${N(c.endDate,i)}, Position ${p.toFixed(1)}% to ${E.toFixed(1)}%, width ${v.toFixed(1)}%`);let h=document.createElement("div");h.className="timeline-segment gap",h.style.left=`${p}%`,h.style.width=`${v}%`,h.style.zIndex="2";let $=document.createElement("div");$.className="timeline-segment-tooltip",$.textContent="Gap",h.appendChild($),t.appendChild(h)}}}let y=document.getElementById("timeline-start-year"),f=document.getElementById("timeline-end-year");y&&(y.textContent=a,y.style.fontWeight="bold"),f&&(f.textContent=e,f.style.fontWeight="bold");let g=t.parentElement,I=document.getElementById("required-period-label");I||(I=document.createElement("div"),I.id="required-period-label",I.style.textAlign="center",I.style.marginTop="5px",I.style.fontSize="12px",I.style.color="#495057",g.appendChild(I)),D===0?I.textContent="Employment verification (timeframe not specified)":I.textContent=`Required ${D}-year period`;let b=Q(),S=document.getElementById("years-accounted");S&&(S.textContent=b.toFixed(1));let x=document.getElementById("time-validation");if(x)if(D===0){let c=document.getElementById("entries-list");((c==null?void 0:c.querySelectorAll(".entry-summary"))||[]).length>0?(x.textContent="Employment verification complete.",x.classList.add("success"),x.style.color="#28a745"):(x.textContent=te.pleaseAddEmployer,x.classList.remove("success"),x.style.color="#dc3545")}else b<D?(x.textContent=te.accountForYears(D),x.classList.remove("success"),x.style.color="#dc3545"):(x.textContent="Timeframe requirement met.",x.classList.add("success"),x.style.color="#28a745");let B=document.getElementById("to-signature-btn");if(B){let c=D===0?u.length>0:b>=D;console.log(`Setting "Next: Signature" button disabled=${!c}`),B.disabled=!c}}var ne=!1,oe;function fe(t,o){ne=t,oe=o}function re(t){switch(t){case 1:let o=document.getElementById("full_name"),e=document.getElementById("email");if(o.value)Y(o);else return q(o,"Please enter your full name."),!1;if(e.value)Y(e);else return q(e,"Please enter your email address."),!1;return!0;case 2:return!0;case 3:return!0;case 5:if(ne){let r=document.getElementById("school_name"),a=document.getElementById("degree_level");if(r.value)Y(r);else return q(r,"Please enter your school name."),!1;if(a.value)Y(a);else return q(a,"Please select a degree level."),!1}return!0;case 4:return!0;default:return!0}}function pe(t){if(!t)return console.error("No entry provided for validation"),!1;let o=t.getAttribute("data-index");console.log(`Validating entry with index: ${o}`);let e=document.getElementById(`entry_type_${o}`);if(!e||!e.value)return console.error(`Entry type is missing for index ${o}`),!1;if(console.log(`Entry type: ${e.value}`),e.value==="Job"){let i=document.getElementById(`company_${o}`),n=document.getElementById(`position_${o}`),s=document.getElementById(`contact_name_${o}`),l=document.getElementById(`contact_info_${o}`);if(parseInt(o)===0?(console.log("VALIDATING FIRST JOB ENTRY"),console.log("First job entry fields:"),console.log(`- Company: ${(i==null?void 0:i.value)||"MISSING"}`),console.log(`- Position: ${(n==null?void 0:n.value)||"MISSING"}`),console.log(`- Contact Name: ${(s==null?void 0:s.value)||"MISSING"}`),console.log(`- Contact Info: ${(l==null?void 0:l.value)||"MISSING"}`),console.log("Element existence check:"),console.log(`- Company element exists: ${!!i}`),console.log(`- Position element exists: ${!!n}`),console.log(`- Contact Name element exists: ${!!s}`),console.log(`- Contact Info element exists: ${!!l}`)):console.log(`Job fields - Company: ${i==null?void 0:i.value}, Position: ${n==null?void 0:n.value}, Contact Name: ${s==null?void 0:s.value}, Contact Info: ${l==null?void 0:l.value}`),i&&!i.value)return q(i,"Company field is required"),!1;if(n&&!n.value)return q(n,"Position field is required"),!1;if(s&&!s.value)return q(s,"Contact name field is required"),!1;if(l&&!l.value)return q(l,"Contact info field is required"),!1}else if(e.value==="Education"){let i=document.getElementById(`company_${o}`),n=document.getElementById(`position_${o}`);if(console.log(`Education fields - Institution: ${i==null?void 0:i.value}, Degree: ${n==null?void 0:n.value}`),i&&!i.value)return q(i,"Institution field is required"),!1;if(n&&!n.value)return q(n,"Degree field is required"),!1}let r=document.getElementById(`start_date_${o}`),a=document.getElementById(`end_date_${o}`),d=document.getElementById(`is_current_${o}`);if(console.log(`Date fields - Start Date: ${r==null?void 0:r.value}, End Date: ${a==null?void 0:a.value}, Is Current: ${d==null?void 0:d.checked}`),r&&!r.value)return q(r,"Start date is required"),!1;if(r&&Y(r),a&&!d.checked&&!a.value)return q(a,"End date is required when not currently employed"),!1;if(a&&Y(a),r&&r.value&&a&&a.value){let i=r.value.split("-"),n=a.value.split("-");if(i.length===2&&n.length===2){let s=parseInt(i[0]),l=parseInt(i[1]),u=parseInt(n[0]),m=parseInt(n[1]);if(console.log(`Date comparison - Start: ${s}-${l}, End: ${u}-${m}`),s>u||s===u&&l>m)return q(r,oe.startBeforeEnd(parseInt(o)+1)),!1;Y(r),Y(a)}}return console.log("Entry validation successful"),!0}function w(t=!1){console.log("Validating form, isSubmission:",t);let o=!0,e=document.getElementById("submit-button"),r=document.getElementById("time-validation"),a=document.getElementById("to-signature-btn"),d=document.getElementById("full_name"),i=document.getElementById("email");d&&!d.value&&(o=!1),i&&!i.value&&(o=!1),document.querySelectorAll(".timeline-entry").forEach(f=>{let g=f.getAttribute("data-index"),I=document.getElementById(`entry_type_${g}`);if(!I||!I.value){o=!1;return}if(I.value==="Job"){let B=document.getElementById(`company_${g}`),c=document.getElementById(`position_${g}`),p=document.getElementById(`contact_name_${g}`),E=document.getElementById(`contact_info_${g}`);B&&!B.value&&(o=!1),c&&!c.value&&(o=!1),p&&!p.value&&(o=!1),E&&!E.value&&(o=!1)}else if(I.value==="Education"){let B=document.getElementById(`company_${g}`),c=document.getElementById(`position_${g}`);B&&!B.value&&(o=!1),c&&!c.value&&(o=!1)}let b=document.getElementById(`start_date_${g}`),S=document.getElementById(`end_date_${g}`),x=document.getElementById(`is_current_${g}`);if(b&&!b.value&&(o=!1),S&&!x.checked&&!S.value&&(o=!1),b&&b.value&&S&&S.value){let B=b.value.split("-"),c=S.value.split("-");if(B.length===2&&c.length===2&&!isNaN(parseInt(B[0]))&&!isNaN(parseInt(B[1]))&&!isNaN(parseInt(c[0]))&&!isNaN(parseInt(c[1]))){let p=parseInt(B[0]),E=parseInt(B[1]),v=parseInt(c[0]),h=parseInt(c[1]);if((p>v||p===v&&E>h)&&(o=!1,t)){let $=document.createElement("div");$.setAttribute("aria-live","assertive"),$.classList.add("validation-message"),$.textContent=oe.startBeforeEnd(parseInt(g)+1),$.style.color="#dc3545";let _=document.querySelector(".form-container");_&&(_.insertBefore($,_.firstChild),setTimeout(()=>{_.removeChild($)},5e3))}}}});let s=document.getElementById("entries-list"),l=(s==null?void 0:s.querySelectorAll(".entry-summary"))||[],u=l.length>0;if(console.log(`Form validation found ${l.length} entries in the timeline`),ee(),ne){let f=document.getElementById("school_name"),g=document.getElementById("degree_level");f&&!f.value&&(o=!1),g&&!g.value&&(o=!1)}let m=window.signaturePad;m&&m.isEmpty()&&(o=!1);let y=document.getElementById("legal-acknowledgment");return y&&!y.checked&&(o=!1),e&&(e.disabled=!o),console.log(`Form validation result: ${o?"valid":"invalid"}`),o}function q(t,o){let e=`${t.id}-error`,r=document.getElementById(e);return r||(r=document.createElement("div"),r.id=e,r.className="validation-message",r.setAttribute("aria-live","assertive"),t.parentNode.appendChild(r)),r.textContent=o,t.setAttribute("aria-invalid","true"),t.setAttribute("aria-describedby",e),t.focus(),r}function Y(t){let o=`${t.id}-error`,e=document.getElementById(o);e&&(e.textContent=""),t.removeAttribute("aria-invalid")}var K=0,k;function ge(t){k=t;let o=document.getElementById("add-entry-btn");o&&o.addEventListener("click",function(){let a=parseInt(document.querySelector('input[name="years"]').value)||7,d=Q();if(d>=a){(()=>{let n=document.createElement("div");n.setAttribute("role","alertdialog"),n.setAttribute("aria-modal","true"),n.setAttribute("aria-labelledby","confirm-title"),n.setAttribute("aria-describedby","confirm-desc"),n.className="confirm-dialog",n.style.position="fixed",n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)",n.style.backgroundColor="white",n.style.padding="20px",n.style.border="1px solid #ccc",n.style.boxShadow="0 4px 8px rgba(0,0,0,0.1)",n.style.zIndex="1000",n.style.maxWidth="400px",n.style.width="90%",n.innerHTML=`
                        <h3 id="confirm-title">${k.addAnotherTitle}</h3>
                        <p id="confirm-desc">${k.addAnotherDesc(d.toFixed(1),a)}</p>
                        <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                            <button id="cancel-add" class="button secondary">${k.cancel}</button>
                            <button id="confirm-add" class="button primary">${k.addEntry}</button>
                        </div>
                    `,document.body.appendChild(n),document.getElementById("cancel-add").focus(),document.getElementById("cancel-add").addEventListener("click",()=>{document.body.removeChild(n)}),document.getElementById("confirm-add").addEventListener("click",()=>{document.body.removeChild(n),Z(),P(3)});let s=l=>{l.key==="Escape"&&(document.body.removeChild(n),document.removeEventListener("keydown",s))};document.addEventListener("keydown",s)})();return}Z(),P(3)});let e=document.getElementById("back-to-timeline-btn");e&&e.addEventListener("click",function(){P(2)});let r=document.getElementById("save-entry-btn");r?(console.log("Save entry button found, adding event listener"),r.addEventListener("click",function(a){console.log("Save entry button clicked"),a.preventDefault();try{let d=document.getElementById("current-entry-container"),i=d==null?void 0:d.querySelector(".timeline-entry");if(!i){console.error("No entry found in current-entry-container!");let u=document.createElement("div");u.setAttribute("aria-live","assertive"),u.classList.add("validation-message"),u.textContent=k.noEntryFound,u.style.color="#dc3545";let m=document.querySelector(".form-container");m&&(m.insertBefore(u,m.firstChild),setTimeout(()=>{m.removeChild(u)},5e3));return}let n=i.getAttribute("data-index");console.log(`Attempting to save entry with index: ${n}`);let s=i.querySelectorAll("input, select, textarea");console.log(`Entry has ${s.length} form fields:`),s.forEach(u=>{console.log(`- ${u.id}: ${u.value}`)});let l=De();console.log(`saveCurrentEntry result: ${l}`),l||console.error("saveCurrentEntry failed!")}catch(d){console.error("Error in save entry button handler:",d);let i=document.createElement("div");i.setAttribute("aria-live","assertive"),i.classList.add("validation-message"),i.textContent=k.errorSavingEntry,i.style.color="#dc3545";let n=document.querySelector(".form-container");n&&(n.insertBefore(i,n.firstChild),setTimeout(()=>{n.removeChild(i)},5e3))}})):console.error("Save entry button not found! This will prevent saving entries.")}function Z(){console.log("Creating new entry with entryCount:",K);let t=document.getElementById("timeline-entry-template");if(!t){console.error("Timeline entry template element not found!");return}let o=t.innerHTML;console.log("Timeline entry template HTML:",o);let e=document.getElementById("current-entry-container");if(!e){console.error("Current entry container element not found!");return}e.innerHTML="";let r=K;console.log("Using currentIndex:",r);let a=o.replace(/{index}/g,r).replace(/{index_plus_one}/g,r+1);console.log("Entry HTML after placeholder replacement:",a);let d=document.createElement("div");d.innerHTML=a,e.appendChild(d.firstElementChild);let i=document.getElementById(`is_current_${r}`),n=document.querySelector(".current-employment-checkbox"),s=document.querySelector(".end-date-group"),l=document.getElementById(`end_date_${r}`),u=document.getElementById(`start_date_${r}`);if(r===0)i&&(i.checked=!0),s&&(s.style.display="none"),l&&(l.value="",l.required=!1);else{console.log("Creating subsequent entry with index:",r),n&&(n.style.display="none"),i&&(i.checked=!1),s&&(s.style.display="block");let y=null,g=document.getElementById("entries-list").querySelectorAll(".entry-summary");if(g.length>0){let I=g[g.length-1].getAttribute("data-index"),b=document.getElementById(`start_date_${I}`);if(b&&b.value){y=b.value;let S=y;console.log("Setting end date to previous start date:",S),l&&(l.value=S);let x=S.split("-"),B=parseInt(x[0]),p=parseInt(x[1])-1,E=B;p<1&&(p=12,E--);let v=`${E}-${p.toString().padStart(2,"0")}`;console.log("Setting start date to one month before end date:",v),u&&(u.value=v)}}}ve(r);let m=e.querySelector("select, input, textarea");m&&m.focus()}function De(){var a,d,i,n,s;console.log("Saving entry with entryCount before save:",K);let o=document.getElementById("current-entry-container").querySelector(".timeline-entry");if(!o)return console.error("No entry found to save!"),!1;let e=o.getAttribute("data-index");console.log("Entry index being saved:",e);let r=pe(o);if(console.log("Entry validation result:",r),!r){let l=document.getElementById("current-entry-container");if(l){let u=document.getElementById("entry-form-error");u||(u=document.createElement("div"),u.id="entry-form-error",u.className="validation-message",u.setAttribute("aria-live","assertive"),l.insertBefore(u,l.firstChild)),u.textContent="Please fill in all required fields before saving.",u.style.color="#dc3545"}return!1}try{let l={index:e,type:document.getElementById(`entry_type_${e}`).value,company:((a=document.getElementById(`company_${e}`))==null?void 0:a.value)||"",position:((d=document.getElementById(`position_${e}`))==null?void 0:d.value)||"",startDate:document.getElementById(`start_date_${e}`).value,endDate:document.getElementById(`end_date_${e}`).value,isCurrent:document.getElementById(`is_current_${e}`).checked,description:((i=document.getElementById(`description_${e}`))==null?void 0:i.value)||"",contactName:((n=document.getElementById(`contact_name_${e}`))==null?void 0:n.value)||"",contactInfo:((s=document.getElementById(`contact_info_${e}`))==null?void 0:s.value)||""};console.log("Entry data prepared:",l),we(l),K++,console.log("entryCount after increment:",K),w(),console.log("Attempting to navigate to timeline overview (step 2)"),document.getElementById("step-2")?console.log("Found step-2 element, proceeding with navigation"):(console.error("step-2 element not found! This will cause navigation to fail"),console.log("Available steps:",Array.from(document.querySelectorAll(".form-section[data-step]")).map(y=>y.id))),P(2);let m=Q();return!0}catch(l){console.error("Error saving entry:",l);let u=document.createElement("div");u.setAttribute("aria-live","assertive"),u.classList.add("validation-message"),u.textContent="An error occurred while saving the entry. Please try again.",u.style.color="#dc3545";let m=document.querySelector(".form-container");return m&&(m.insertBefore(u,m.firstChild),setTimeout(()=>{m.removeChild(u)},5e3)),!1}}function we(t){console.log("Updating entries list with data:",t);let o=document.getElementById("entries-list");if(!o){console.error("Entries list element not found!");return}try{let e=o.querySelector(".no-entries-message");e&&(console.log("Removing 'no entries' message"),e.remove());let r=o.querySelector(`.entry-summary[data-index="${t.index}"]`);console.log(`Entry element with index ${t.index} ${r?"exists":"does not exist"}`);let a=l=>{if(!l)return"";let[u,m]=l.split("-");return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(m)-1]} ${u}`},d=a(t.startDate),i=t.isCurrent?"Present":a(t.endDate);console.log(`Formatted dates - Start: ${d}, End: ${i}`);let n=`
            <div class="entry-summary-content">
                <div class="entry-summary-header">
                    <strong>${t.type}</strong>
                    <div class="entry-actions">
                        <button type="button" class="edit-entry" data-index="${t.index}">Edit</button>
                        <button type="button" class="delete-entry" data-index="${t.index}">Delete</button>
                    </div>
                </div>
                ${t.type==="Job"||t.type==="Education"?`<div>${t.position} at ${t.company}</div>`:""}
                <div class="entry-dates">${d} - ${i}</div>
            </div>
        `;if(r)console.log("Updating existing entry"),r.innerHTML=n;else{console.log("Creating new entry"),r=document.createElement("div"),r.className="entry-summary",r.setAttribute("data-index",t.index),r.innerHTML=n,o.appendChild(r);let l=r.querySelector(".edit-entry");l&&l.addEventListener("click",function(){Ae(t.index)});let u=r.querySelector(".delete-entry");u&&u.addEventListener("click",function(){qe(t.index)})}console.log("Entries list updated successfully");let s=(l,u)=>{let m=document.getElementById(l);m||(m=document.createElement("input"),m.type="hidden",m.id=l,m.name=l,document.getElementById("employmentForm").appendChild(m)),m.value=u,console.log(`Hidden field ${l} set to: ${u}`)};s(`entry_type_${t.index}`,t.type),s(`company_${t.index}`,t.company),s(`position_${t.index}`,t.position),s(`start_date_${t.index}`,t.startDate),s(`end_date_${t.index}`,t.endDate),s(`is_current_${t.index}`,t.isCurrent?"on":""),s(`description_${t.index}`,t.description),s(`contact_name_${t.index}`,t.contactName),s(`contact_info_${t.index}`,t.contactInfo),setTimeout(()=>{console.log("Validating form after updating entries list"),w()},100),console.log("Hidden form fields created/updated")}catch(e){console.error("Error updating entries list:",e)}}function Ae(t){var n,s,l,u,m,y,f,g,I;let o=document.getElementById("current-entry-container");o.innerHTML="";let e={type:(n=document.getElementById(`entry_type_${t}`))==null?void 0:n.value,company:(s=document.getElementById(`company_${t}`))==null?void 0:s.value,position:(l=document.getElementById(`position_${t}`))==null?void 0:l.value,startDate:(u=document.getElementById(`start_date_${t}`))==null?void 0:u.value,endDate:(m=document.getElementById(`end_date_${t}`))==null?void 0:m.value,isCurrent:(y=document.getElementById(`is_current_${t}`))==null?void 0:y.checked,description:(f=document.getElementById(`description_${t}`))==null?void 0:f.value,contactName:(g=document.getElementById(`contact_name_${t}`))==null?void 0:g.value,contactInfo:(I=document.getElementById(`contact_info_${t}`))==null?void 0:I.value},a=document.getElementById("timeline-entry-template").innerHTML.replace(/{index}/g,t).replace(/{index_plus_one}/g,parseInt(t)+1),d=document.createElement("div");d.innerHTML=a,o.appendChild(d.firstElementChild),ve(t),e.type&&(document.getElementById(`entry_type_${t}`).value=e.type),e.company&&(document.getElementById(`company_${t}`).value=e.company),e.position&&(document.getElementById(`position_${t}`).value=e.position),e.startDate&&(document.getElementById(`start_date_${t}`).value=e.startDate),e.endDate&&(document.getElementById(`end_date_${t}`).value=e.endDate);let i=document.getElementById(`is_current_${t}`);if(i){if(parseInt(t)>0){let S=document.querySelector(".current-employment-checkbox");S&&(S.style.display="none")}i.checked=e.isCurrent;let b=document.querySelector(".end-date-group");if(e.isCurrent){b&&(b.style.display="none");let S=document.getElementById(`end_date_${t}`);S&&(S.value="",S.required=!1)}else b&&(b.style.display="block")}e.description&&(document.getElementById(`description_${t}`).value=e.description),e.contactName&&(document.getElementById(`contact_name_${t}`).value=e.contactName),e.contactInfo&&(document.getElementById(`contact_info_${t}`).value=e.contactInfo),se(t),P(3)}function qe(t){(()=>{let e=document.createElement("div");e.setAttribute("role","alertdialog"),e.setAttribute("aria-modal","true"),e.setAttribute("aria-labelledby","confirm-title"),e.setAttribute("aria-describedby","confirm-desc"),e.className="confirm-dialog",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.backgroundColor="white",e.style.padding="20px",e.style.border="1px solid #ccc",e.style.boxShadow="0 4px 8px rgba(0,0,0,0.1)",e.style.zIndex="1000",e.style.maxWidth="400px",e.style.width="90%",e.innerHTML=`
            <h3 id="confirm-title">${k.confirmDeleteTitle}</h3>
            <p id="confirm-desc">${k.confirmDeleteDesc}</p>
            <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                <button id="cancel-delete" class="button secondary">${k.cancel}</button>
                <button id="confirm-delete" class="button primary">${k.delete}</button>
            </div>
        `,document.body.appendChild(e),document.getElementById("cancel-delete").focus(),document.getElementById("cancel-delete").addEventListener("click",()=>{document.body.removeChild(e)}),document.getElementById("confirm-delete").addEventListener("click",()=>{document.body.removeChild(e);let a=document.getElementById("entries-list"),d=a.querySelector(`.entry-summary[data-index="${t}"]`);d&&d.remove(),[`entry_type_${t}`,`company_${t}`,`position_${t}`,`start_date_${t}`,`end_date_${t}`,`is_current_${t}`,`description_${t}`,`contact_name_${t}`,`contact_info_${t}`].forEach(s=>{let l=document.getElementById(s);l&&l.parentNode.removeChild(l)}),a.children.length===0&&(a.innerHTML='<p class="no-entries-message">No entries yet. Add your first employment entry.</p>'),w();let n=document.createElement("div");n.setAttribute("aria-live","assertive"),n.classList.add("sr-only"),n.textContent=k.entryDeleted,document.body.appendChild(n),setTimeout(()=>{document.body.removeChild(n)},3e3)});let r=a=>{a.key==="Escape"&&(document.body.removeChild(e),document.removeEventListener("keydown",r))};document.addEventListener("keydown",r)})()}function ve(t){let o=document.getElementById(`entry_type_${t}`);o&&(o.addEventListener("change",function(){se(t),w()}),se(t));let e=document.querySelector(`.remove-entry[data-index="${t}"]`);e&&e.addEventListener("click",function(){let n=document.querySelector(`.timeline-entry[data-index="${t}"]`);n&&document.querySelectorAll(".timeline-entry").length>1&&(n.remove(),w())});let r=document.getElementById(`start_date_${t}`),a=document.getElementById(`end_date_${t}`),d=document.getElementById(`is_current_${t}`);r&&r.addEventListener("blur",w),a&&a.addEventListener("blur",w),d&&d.addEventListener("change",function(){let n=document.querySelector(".end-date-group");this.checked?(n&&(n.style.display="none"),a&&(a.value="",a.required=!1)):(n&&(n.style.display="block"),a&&(a.required=!0)),w()}),[document.getElementById(`company_${t}`),document.getElementById(`position_${t}`),document.getElementById(`contact_name_${t}`),document.getElementById(`contact_info_${t}`)].forEach(n=>{n&&n.addEventListener("input",w)})}function se(t){let o=document.getElementById(`entry_type_${t}`).value,e=document.querySelector(`.timeline-entry[data-index="${t}"]`);if(e){let r=e.querySelector(".job-fields"),a=e.querySelector(".contact-fields");o==="Job"?(r&&(r.style.display="block"),a&&(a.style.display="block"),A(e,".company-field",!0),A(e,".position-field",!0),A(e,".contact-name-field",!0),A(e,".contact-info-field",!0)):o==="Education"?(r&&(r.style.display="block"),a&&(a.style.display="none"),A(e,".company-field",!0),A(e,".position-field",!0),A(e,".contact-name-field",!1),A(e,".contact-info-field",!1)):(r&&(r.style.display="none"),a&&(a.style.display="none"),A(e,".company-field",!1),A(e,".position-field",!1),A(e,".contact-name-field",!1),A(e,".contact-info-field",!1))}}var O=1,ie=!1,ae;function Ee(t,o){ie=t,ae=o,O=1,document.querySelectorAll(".next-step").forEach(e=>{e.addEventListener("click",function(){let r=parseInt(this.getAttribute("data-next"));if(r===4||r===5){let a=parseInt(document.querySelector('input[name="years"]').value)||7;if(a===0){let d=document.getElementById("entries-list");if(((d==null?void 0:d.querySelectorAll(".entry-summary"))||[]).length===0){let n=document.createElement("div");n.setAttribute("aria-live","assertive"),n.classList.add("validation-message"),n.textContent=ae.pleaseAddEmployer,n.style.color="#dc3545";let s=document.querySelector(".form-container");s&&(s.insertBefore(n,s.firstChild),setTimeout(()=>{s.removeChild(n)},5e3));return}}else{let d=document.getElementById("years-accounted");if((d?parseFloat(d.textContent):0)<a){let n=document.createElement("div");n.setAttribute("aria-live","assertive"),n.classList.add("validation-message"),n.textContent=ae.accountForYears(a),n.style.color="#dc3545";let s=document.querySelector(".form-container");s&&(s.insertBefore(n,s.firstChild),setTimeout(()=>{s.removeChild(n)},5e3));return}}}O===1&&r===2?re(O)&&(Z(),P(3)):re(O)&&P(r)})}),document.querySelectorAll(".prev-step").forEach(e=>{e.addEventListener("click",function(){let r=parseInt(this.getAttribute("data-prev"));P(r)})}),he(O)}function P(t){console.log(`Navigating to step ${t}`);try{if(t=parseInt(t),isNaN(t)){console.error(`Invalid step: ${t}`);return}let o=document.createElement("div");if(o.setAttribute("aria-live","assertive"),o.classList.add("sr-only"),document.body.appendChild(o),t===2){let r=document.getElementById("step-2");if(!r){console.error("Step 2 element not found, attempting to create it");let a=document.querySelector(".form-steps");if(a){let d=parseInt(document.querySelector('input[name="years"]').value)||7,i=new Date().getFullYear(),n=i-d;r=document.createElement("section"),r.className="form-section",r.id="step-2",r.setAttribute("data-step","2"),r.innerHTML=`
                        <h2>Employment Timeline</h2>
                        <p>Please account for the last ${d} years of your employment history, including any gaps.</p>
                        
                        <div class="timeline-visualization">
                            <h3>Timeline Coverage</h3>
                            <div class="timeline-container">
                                <div class="timeline-ruler"></div>
                                <div id="timeline-segments"></div>
                                <div class="timeline-labels">
                                    <div class="timeline-start-label">Now - <span id="timeline-start-year">${n}</span></div>
                                    <div class="timeline-end-label"><span id="timeline-end-year">${i}</span></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="time-accounted">
                            <span>Time accounted for: </span>
                            <span id="years-accounted">0</span>
                            <span> years</span>
                            <div id="time-validation" class="validation-message"></div>
                        </div>
                        
                        <div class="entries-summary" id="entries-summary">
                            <h3>Your Entries</h3>
                            <div id="entries-list" class="entries-list">
                                <p class="no-entries-message">No entries yet. Add your first employment entry.</p>
                            </div>
                        </div>
                        
                        <div class="form-navigation">
                            <button type="button" class="button secondary prev-step" data-prev="1">Previous: Personal Information</button>
                            <button type="button" class="button secondary" id="add-entry-btn">Add Employment Entry</button>
                            <button type="button" class="button primary next-step" id="to-signature-btn" data-next="4" disabled>Next: Signature</button>
                        </div>
                    `;let s=document.getElementById("step-1");s&&s.nextSibling?a.insertBefore(r,s.nextSibling):a.appendChild(r),console.log("Created step-2 element");let l=r.querySelector("#add-entry-btn");l&&l.addEventListener("click",function(){Z(),P(3)});let u=r.querySelector(".prev-step");u&&u.addEventListener("click",function(){P(1)});let m=r.querySelector("#to-signature-btn");m&&m.addEventListener("click",function(){P(4)})}else{console.error("Form steps container not found, cannot create step-2");return}}}document.querySelectorAll(".form-section[data-step]").forEach(r=>{r.style.display="none",console.log(`Hidden step: ${r.id}`)});let e=document.getElementById(`step-${t}`);if(e)console.log(`Found target step: step-${t}`),e.style.cssText="display: block !important",O=t,he(t),e.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{console.log(`Step ${t} should now be visible`);let r=window.getComputedStyle(e);if(console.log(`Step ${t} computed display: ${r.display}`),r.display==="none"){console.error(`Step ${t} is still hidden after setting display to block!`),e.style.cssText="display: block !important";let i=e.parentNode,n=e.nextSibling;i.removeChild(e),i.insertBefore(e,n),e.style.cssText="display: block !important"}t===2&&ee();let a=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');a.length>0&&a[0].focus();let d=e.querySelector("h2");if(d){let i=document.querySelector('[aria-live="assertive"].sr-only');i&&(i.textContent=`Step ${t}: ${d.textContent}`,setTimeout(()=>{i.textContent=""},3e3))}},100);else{console.error(`Target step element not found: step-${t}`);let r=document.querySelectorAll(".form-section[data-step]");console.log(`Available steps: ${Array.from(r).map(a=>a.id).join(", ")}`)}}catch(o){console.error(`Error navigating to step ${t}:`,o)}}function he(t){let o=document.getElementById("step-indicator");if(o){let e="",r=ie?5:4;switch(t){case 1:e=`Step 1 of ${r}: Personal Information`;break;case 2:e=`Step 2 of ${r}: Timeline Overview`;break;case 3:e=`Step 3 of ${r}: Employment Entry`;break;case 5:e=`Step 4 of ${r}: Degree Verification`;break;case 4:e=`Step ${ie?"5":"4"} of ${r}: Attestation & Signature`;break}o.textContent=e}}function Ke(){return O}var R;function $e(){let t=document.getElementById("signature-canvas");if(!t){console.error("Signature canvas element not found");return}R=new SignaturePad(t,{backgroundColor:"rgb(255, 255, 255)",penColor:"rgb(0, 0, 0)"}),t.setAttribute("tabindex","0"),t.setAttribute("role","application"),t.setAttribute("aria-label","Signature pad. Use mouse or touch to draw your signature."),t.addEventListener("focus",function(){let e=document.getElementById("signature-instructions");e&&(e.textContent="Press Space or Enter to start drawing. Use arrow keys to navigate. Press Escape to cancel.")}),t.addEventListener("keydown",function(e){(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),t.classList.toggle("keyboard-drawing"))});let o=document.getElementById("clear-signature");o&&o.addEventListener("click",function(){R.clear(),w();let e=document.createElement("div");e.setAttribute("aria-live","assertive"),e.classList.add("sr-only"),e.textContent="Signature cleared",document.body.appendChild(e),setTimeout(()=>{document.body.removeChild(e)},3e3)}),window.signaturePad=R}function Ie(){return R&&!R.isEmpty()?R.toDataURL():null}function Qe(){return R?R.isEmpty():!0}document.addEventListener("DOMContentLoaded",function(){return ue(this,null,function*(){let t=document.documentElement.lang||"en";console.log(`Detected language: ${t}`);let o=document.getElementById("language-select");o&&o.addEventListener("change",function(){let y=this.value,f=new URL(window.location.href);f.searchParams.set("lang",y),window.location.href=f.toString()});let e;try{let y=yield fetch(`/translations/${t}`);if(y.ok){let f=yield y.json();console.log("Loaded translations from server:",f),e=de(H({},f),{accountForYears:g=>f.accountForYears.replace("{0}",g),startBeforeEnd:g=>f.startBeforeEnd.replace("{0}",g),addAnotherDesc:(g,I)=>f.addAnotherDesc.replace("{0}",g).replace("{1}",I)})}else throw new Error("Failed to load translations")}catch(y){console.error("Error loading translations:",y),e={errorSavingEntry:"An error occurred while saving the entry. Please try again.",noEntryFound:"Error: No entry found to save. Please try again or refresh the page.",pleaseAddEmployer:"Please add at least one employer before proceeding.",accountForYears:f=>`Please account for at least ${f} years before proceeding.`,startBeforeEnd:f=>`Start month must be before end month for entry #${f}`,confirmDeleteTitle:"Confirm Deletion",confirmDeleteDesc:"Are you sure you want to delete this entry?",cancel:"Cancel",delete:"Delete",entryDeleted:"Entry deleted",addAnotherTitle:"Add Another Entry?",addAnotherDesc:(f,g)=>`You've already accounted for ${f} years, which meets the requirement of ${g} years. Do you still want to add another entry?`,addEntry:"Add Entry"}}let r=parseInt(document.querySelector('input[name="years"]').value)||7,a=new Date().getFullYear(),d=a-r,i=document.querySelector('input[name="degree_required"]')?document.querySelector('input[name="degree_required"]').value==="true":!1,n=document.getElementById("timeline-start-year"),s=document.getElementById("timeline-end-year");n&&(n.textContent=d),s&&(s.textContent=a),fe(i,e),Ee(i,e),ye(r,e),ge(e),$e();let l=document.getElementById("employmentForm");l&&l.addEventListener("submit",function(y){if(!w(!0))return y.preventDefault(),!1;let f=Ie();f&&(document.getElementById("signature_data").value=f)});let u=document.getElementById("full_name");u&&u.addEventListener("input",function(){document.getElementById("attestation-name").textContent=this.value||"[Your Name]",w()});let m=document.getElementById("legal-acknowledgment");m&&m.addEventListener("change",w)})});})();
//# sourceMappingURL=form.js.map
